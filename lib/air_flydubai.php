<?
$ru_air = array (
                    'Абха' => 'AHB',
                    'Аддис-Абеба' => 'ADD',
                    'Александрия' => 'HBE',
                    'Алматы' => 'ALA',
                    'Амман' => 'AMM',
                    'Ан-Наджаф' => 'NJF',
                    'Асмэра' => 'ASM',
                    'Астана' => 'TSE',
                    'Ахваз' => 'AWZ',
                    'Ахмадабад' => 'AMD',
                    'Ашхабад' => 'ASB',
                    'Багдад' => 'BGW',
                    'Баку' => 'GYD',
                    'Басра' => 'BSR',
                    'Бахрейн' => 'BAH',
                    'Бейрут' => 'BEY',
                    'Белград' => 'BEG',
                    'Бендер-Аббас' => 'BND',
                    'Бишкек' => 'FRU',
                    'Братислава' => 'BTS',
                    'Бужумбура ' => 'BJM',
                    'Бухарест' => 'OTP',
                    'Вена' => 'XWC',
                    'Гассим' => 'ELQ',
                    'Гоа' => 'GOI',
                    'Дакка' => 'DAC',
                    'Даммам' => 'DMM',
                    'Дар-эс-Салам' => 'DAR',
                    'Дели' => 'DEL',
                    'Джибути' => 'JIB',
                    'Джидда' => 'JED',
                    'Джизан' => 'GIZ',
                    'Джуба' => 'JUB',
                    'Доха' => 'DOH',
                    'Дубай' => 'DXB',
                    'Дубай' => 'DWC',
                    'Душанбе' => 'DYU',
                    'Екатеринбург' => 'SVX',
                    'Ереван' => 'EVN',
                    'Загреб' => 'ZAG',
                    'Занзибар' => 'ZNZ',
                    'Исфахан' => 'IFN',
                    'Кабул' => 'KBL',
                    'Казань' => 'KZN',
                    'Карачи' => 'KHI',
                    'Катманду' => 'KTM',
                    'Кветта' => 'UET',
                    'Кигали' => 'KGL',
                    'Киев' => 'IEV',
                    'Коломбо' => 'CMB',
                    'Коччи' => 'COK',
                    'Краснодар' => 'KRR',
                    'Кувейт' => 'KWI',
                    'Лакхнау' => 'LKO',
                    'Лар' => 'LRR',
                    'Любляна' => 'LJU',
                    'Мале' => 'MLE',
                    'Маскат' => 'MCT',
                    'Маттала' => 'HRI',
                    'Медина' => 'MED',
                    'Мешхед' => 'MHD',
                    'МинеральныеВоды' => 'MRV',
                    'Москва' => 'VKO',
                    'Мултан' => 'MUX',
                    'Мумбаи' => 'BOM',
                    'НижнийНовгород' => 'GOJ',
                    'Одесса' => 'ODS',
                    'Порт-Судан' => 'PZU',
                    'Прага' => 'PRG',
                    'Ростов-на-Дону' => 'ROV',
                    'Салала' => 'SLL',
                    'Самара' => 'KUF',
                    'Сараево' => 'SJJ',
                    'Сиялкот' => 'SKT',
                    'Скопье' => 'SKP',
                    'София' => 'SOF',
                    'Стамбул' => 'SAW',
                    'Табук' => 'TUU',
                    'Таиф' => 'TIF',
                    'Тбилиси' => 'TBS',
                    'Тебриз' => 'TBZ',
                    'Тегеран' => 'IKA',
                    'Тируванантапурам' => 'TRV',
                    'Уфа' => 'UFA',
                    'Фейсалабад' => 'LYP',
                    'Хайдарабад' => 'HYD',
                    'Хаиль' => 'HAS',
                    'Хамадан' => 'HDM',
                    'Харгейса' => 'HGA',
                    'Хартум' => 'KRT',
                    'Ченнаи' => 'MAA',
                    'Читтагонг' => 'CGP',
                    'Шираз' => 'SYZ',
                    'Шымкент' => 'CIT',
                    'Эль-Джауф' => 'AJF',
                    'Эль-Хуфуф' => 'HOF',
                    'Энтеббе' => 'EBB',
                    'Эрбиль' => 'EBL',
                    'Эр-Рияд' => 'RUH',
                    'Янбу' => 'YNB'
    );

$airports = array(
                'AHB' => 'Abha Airport (AHB) - Abha',           
                'ADD' => 'Addis Ababa Airport (ADD) - Addis Ababa',              
               	'AMD' => 'Ahmedabad Airport (AMD) - Ahmedabad',              
               	'AWZ' => 'Ahwaz Airport (AWZ) - Ahwaz',              
                'HBE' => 'Alexandria Borg El Arab Airport (HBE) - Alexandria',            
                'ALA' => 'Almaty Airport (ALA) - Almaty',            
                'AMM' => 'Amman Airport (AMM) - Amman',            
                'ASB' => 'Ashgabat Airport (ASB) - Ashgabat',            
                'ASM' => 'Asmara Airport (ASM) - Asmara',            
                'TSE' => 'Astana Airport (TSE) - Astana',            
                'BGW' => 'Baghdad Airport (BGW) - Baghdad',            
                'BAH' => 'Bahrain Airport (BAH) - Bahrain',            
                'GYD' => 'Baku Airport (GYD) - Baku',            
                'BND' => 'Bandar Abbas Airport (BND) - Bandar Abbas',            
                'BSR' => 'Basra Airport (BSR) - Basra',            
                'BEY' => 'Beirut Airport (BEY) - Beirut',            
                'BEG' => 'Belgrade Airport (BEG) - Belgrade',            
                'FRU' => 'Bishkek Airport (FRU) - Bishkek',            
                'BTS' => 'Bratislava Airport (BTS) - Bratislava',            
                'OTP' => 'Bucharest Airport (OTP) - Bucharest',            
                'BJM' => 'Bujumbura Airport (BJM) - Bujumbura',            
                'MAA' => 'Chennai Airport (MAA) - Chennai',            
                'CGP' => 'Chittagong Airport (CGP) - Chittagong',            
                'CMB' => 'Colombo Airport (CMB) - Colombo',            
                'DMM' => 'Dammam Airport (DMM) - Dammam',            
                'DAR' => 'Dar es Salaam Airport (DAR) - Dar es Salaam',            
                'DEL' => 'Delhi Airport (DEL) - Delhi',            
                'DAC' => 'Dhaka Airport (DAC) - Dhaka',            
                'JIB' => 'Djibouti Airport (JIB) - Djibouti',            
                'DOH' => 'Doha Airport (DOH) - Doha',            
                'DXB' => 'Dubai All Airports (DXB) - Dubai',            
                'DWC' => 'Al Maktoum International Airport (DWC) - Dubai',            
                'DXB' => 'Dubai International Airport (DXB) - Dubai',            
                'DYU' => 'Dushanbe Airport (DYU) - Dushanbe',            
                'EBB' => 'Entebbe Airport (EBB) - Entebbe',            
                'EBL' => 'Erbil Airport (EBL) - Erbil',            
                'IFN' => 'Esfahan Airport (IFN) - Esfahan',            
                'LYP' => 'Faisalabad Airport (LYP) - Faisalabad',            
                'ELQ' => 'Gassim Airport (ELQ) - Gassim',            
                'GIZ' => 'Gizan Airport (GIZ) - Gizan',            
                'GOI' => 'Goa Airport (GOI) - Goa',            
                'HAS' => 'Hail Airport (HAS) - Hail',            
                'HDM' => 'Hamadan Airport (HDM) - Hamadan',            
                'HGA' => 'Hargeisa Airport (HGA) - Hargeisa',            
                'HOF' => 'Hofuf Airport (HOF) - Hofuf',            
                'HYD' => 'Hyderabad Airport (HYD) - Hyderabad',            
                'SAW' => 'Istanbul Sabiha Airport (SAW) - Istanbul',            
                'JED' => 'Jeddah Airport (JED) - Jeddah',            
                'AJF' => 'Jouf Airport (AJF) - Jouf',            
                'JUB' => 'Juba Airport (JUB) - Juba',            
                'KBL' => 'Kabul Airport (KBL) - Kabul',            
                'KHI' => 'Karachi Airport (KHI) - Karachi',            
                'KTM' => 'Kathmandu Airport (KTM) - Kathmandu',            
                'KZN' => 'Kazan Airport (KZN) - Kazan',            
                'KRT' => 'Khartoum Airport (KRT) - Khartoum',            
                'IEV' => 'Zhulyany Airport (IEV) - Kiev',            
                'KGL' => 'Kigali Airport (KGL) - Kigali',            
                'COK' => 'Kochi Airport (COK) - Kochi',            
                'KRR' => 'Krasnodar Airport (KRR) - Krasnodar',            
                'KWI' => 'Kuwait Airport (KWI) - Kuwait',            
                'LRR' => 'Lar Airport (LRR) - Lar',            
                'LJU' => 'Ljubljana (Central bus station) (LJU) - Ljubljana',            
                'LKO' => 'Lucknow Airport (LKO) - Lucknow',            
                'MED' => 'Madinah Airport (MED) - Madinah',            
                'MLE' => 'Male Airport (MLE) - Male',            
                'MHD' => 'Mashhad Airport (MHD) - Mashhad',            
                'HRI' => 'Mattala Airport (HRI) - Mattala',            
                'MRV' => 'Mineralnye Vody Airport (MRV) - Mineralnye Vody',            
                'VKO' => 'Vnukovo Airport (VKO) - Moscow',            
                'MUX' => 'Multan Airport (MUX) - Multan',            
                'BOM' => 'Mumbai Airport (BOM) - Mumbai',            
                'MCT' => 'Muscat Airport (MCT) - Muscat',            
                'NJF' => 'Najaf Airport (NJF) - Najaf',            
                'GOJ' => 'Nizhny Novgorod Airport (GOJ) - Nizhny Novgorod',            
                'ODS' => 'Odessa Airport (ODS) - Odessa',            
                'PZU' => 'Port Sudan Airport (PZU) - Port Sudan',            
                'PRG' => 'Prague Airport (PRG) - Prague',            
                'UET' => 'Quetta Airport (UET) - Quetta',            
                'RUH' => 'Riyadh Airport (RUH) - Riyadh',            
                'ROV' => 'Rostov on Don Airport (ROV) - Rostov on Don',            
                'SLL' => 'Salalah Airport (SLL) - Salalah',            
                'KUF' => 'Samara Airport (KUF) - Samara',            
                'SJJ' => 'Sarajevo Airport (SJJ) - Sarajevo',            
                'SYZ' => 'Shiraz Airport (SYZ) - Shiraz',            
                'CIT' => 'Shymkent Airport (CIT) - Shymkent',            
                'SKT' => 'Sialkot Airport (SKT) - Sialkot',            
                'SKP' => 'Skopje Airport (SKP) - Skopje',            
                'SOF' => 'Sofia Airport (SOF) - Sofia',            
                'TBZ' => 'Tabriz Airport (TBZ) - Tabriz',            
                'TUU' => 'Tabuk Airport (TUU) - Tabuk',            
                'TIF' => 'Taif Airport (TIF) - Taif',            
                'TBS' => 'Tbilisi Airport (TBS) - Tbilisi',            
                'IKA' => 'Tehran Airport (IKA) - Tehran',            
                'TRV' => 'Thiruvananthapuram Airport (TRV) - Thiruvananthapuram',            
                'UFA' => 'Ufa Airport (UFA) - Ufa',            
                'XWC' => 'Vienna (Central train station) (XWC) - Vienna',            
                'YNB' => 'Yanbu Airport (YNB) - Yanbu',            
                'SVX' => 'Yekaterinburg Airport (SVX) - Yekaterinburg',            
                'EVN' => 'Yerevan Airport (EVN) - Yerevan',            
                'ZAG' => 'Zagreb Airport (ZAG) - Zagreb',            
                'ZNZ' => 'Zanzibar Airport (ZNZ) - Zanzibar'           
);

function post_content ($url,$postdata) {  //первый запрос на выборку
    $uagent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)";

    $ch = curl_init( $url );
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_HEADER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_ENCODING, "gzip, deflate");
    curl_setopt($ch, CURLOPT_USERAGENT, $uagent);
    curl_setopt($ch, CURLOPT_TIMEOUT, 180);
    curl_setopt($ch, CURLOPT_FAILONERROR, 1);
    curl_setopt($ch, CURLOPT_AUTOREFERER, 1);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $postdata);
    curl_setopt($ch, CURLOPT_COOKIEJAR, "coo.txt");
    curl_setopt($ch, CURLOPT_COOKIEFILE,"coo.txt");

    $content = curl_exec( $ch );
    $err = curl_errno( $ch );
    $errmsg = curl_error( $ch );
    $header = curl_getinfo( $ch );
    curl_close( $ch );

    $header['errno'] = $err;
    $header['errmsg'] = $errmsg;
    $header['content'] = $content;
    //echo $header;
    return $header;
}

function next_day($origin, $destination, $date){

if( $curl = curl_init() ) {
    $uagent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)";
    curl_setopt($curl, CURLOPT_URL, 'http://flights.flydubai.com/en/results/');
    curl_setopt($curl, CURLOPT_HEADER, true);
    curl_setopt($curl, CURLOPT_ENCODING, "gzip, deflate");
    curl_setopt($curl, CURLOPT_USERAGENT, $uagent);
    curl_setopt($curl, CURLOPT_COOKIEJAR, "coo.txt");
    curl_setopt($curl, CURLOPT_COOKIEFILE,"coo.txt");
    curl_setopt($curl, CURLOPT_RETURNTRANSFER,true);
    $out = curl_exec($curl);
    preg_match('/RT\(([0-9]+)/', $out, $matches);
    curl_close($curl);
   } 
//echo 'http://flights.flydubai.com/en/results/threedayview/?_='.$matches[1];
 /*  
if( $curl = curl_init() ) {
    $uagent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)";
    curl_setopt($curl, CURLOPT_URL, 'http://flights.flydn='.$origin.'&destination='.$destination.'&originalSegmentId=1&monthtabtype=Economy&_='.$matches[1]);
    curl_setopt($curl, CURLOPT_HEADER, true);
    curl_setopt($curl, CURLOPT_ENCODING, "gzip, deflate");
    curl_setopt($curl, CURLOPT_USERAGENT, $uagent);
    curl_setopt($curl, CURLOPT_COOKIEJAR, "/coo.txt");
    curl_setopt($curl, CURLOPT_COOKIEFILE,"/coo.txt");
    curl_setopt($curl, CURLOPT_RETURNTRANSFER,true);
    $out = curl_exec($curl);
    preg_match('/RT\(([0-9]+)/', $out, $matches);
    //echo $out;
    curl_close($curl);
   } 
*/
    if( $curl = curl_init() ) {
    $uagent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)";
    curl_setopt($curl, CURLOPT_URL, 'http://flights.flydubai.com/en/results/onemonthviewsegment/?segmentid=1&_='.$matches[1]);
    curl_setopt($curl, CURLOPT_HEADER, false);
    curl_setopt($curl, CURLOPT_ENCODING, "gzip, deflate");
    curl_setopt($curl, CURLOPT_USERAGENT, $uagent);
    curl_setopt($curl, CURLOPT_COOKIEJAR, "coo.txt");
    curl_setopt($curl, CURLOPT_COOKIEFILE,"coo.txt");
    curl_setopt($curl, CURLOPT_RETURNTRANSFER,true);
    $html[0] = curl_exec($curl);

    curl_close($curl);
   }
    if( $curl = curl_init() ) {
    $uagent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)";
    curl_setopt($curl, CURLOPT_URL, 'http://flights.flydubai.com/en/results/onemonthviewsegment/?segmentid=2&_='.$matches[1]);
    curl_setopt($curl, CURLOPT_HEADER, false);
    curl_setopt($curl, CURLOPT_ENCODING, "gzip, deflate");
    curl_setopt($curl, CURLOPT_USERAGENT, $uagent);
    curl_setopt($curl, CURLOPT_COOKIEJAR, "coo.txt");
    curl_setopt($curl, CURLOPT_COOKIEFILE,"coo.txt");
    curl_setopt($curl, CURLOPT_RETURNTRANSFER,true);
    $html[1] = curl_exec($curl);
    //echo $html[1];
    curl_close($curl);
   }
   
   return $html;
}